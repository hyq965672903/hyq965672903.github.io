{"title":"å‰‘æŒ‡æºç -spring(å››)-åç½®å¤„ç†å™¨å¹²é¢„ç”Ÿå‘½å‘¨æœŸ","slug":"å‰‘æŒ‡æºç -spring-å››-åç½®å¤„ç†å™¨å¹²é¢„ç”Ÿå‘½å‘¨æœŸ","date":"2022-04-25T12:27:38.000Z","updated":"2024-04-22T07:21:14.907Z","comments":true,"path":"api/articles/å‰‘æŒ‡æºç -spring-å››-åç½®å¤„ç†å™¨å¹²é¢„ç”Ÿå‘½å‘¨æœŸ.json","excerpt":" é€šè¿‡æºç äº†è§£åˆ°æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæœ‰ä¸‰ç§ç±»å‹çš„ ç”Ÿå‘½å‘¨æœŸå¢å¼ºå™¨ BeanFactoryPostProcessorï¼ˆBeanå·¥å‚å¢å¼ºï¼‰ï¼ŒBeanPostProcessorï¼ˆBeanåç½®å¤„ç†å™¨ï¼‰ä»¥åŠInitializingBeanï¼ˆåˆå§‹åŒ–Beanå¢å¼ºï¼‰ï¼Œæœ¬ç« èŠ‚åˆ†æè¿™äº›å¢å¼ºå™¨æ˜¯å¦‚ä½•å¹²é¢„ç”Ÿå‘½å‘¨æœŸçš„","covers":["http://hyqup-blog-upyun.test.upcdn.net/img/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%A2%9E%E5%BC%BA%E5%99%A8.drawio.png"],"content":"<p> é€šè¿‡æºç äº†è§£åˆ°æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæœ‰ä¸‰ç§ç±»å‹çš„ <strong>ç”Ÿå‘½å‘¨æœŸå¢å¼ºå™¨</strong> BeanFactoryPostProcessorï¼ˆBeanå·¥å‚å¢å¼ºï¼‰ï¼ŒBeanPostProcessorï¼ˆBeanåç½®å¤„ç†å™¨ï¼‰ä»¥åŠInitializingBeanï¼ˆåˆå§‹åŒ–Beanå¢å¼ºï¼‰ï¼Œæœ¬ç« èŠ‚åˆ†æè¿™äº›å¢å¼ºå™¨æ˜¯å¦‚ä½•å¹²é¢„ç”Ÿå‘½å‘¨æœŸçš„</p>\n<span id=\"more\"></span>\n\n<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ğŸ‰BeanFactoryPostProcessorï¼šåç½®å¢å¼ºå·¥å‚</p>\n<p>ğŸ¨BeanPostProcessor: åç½®å¢å¼ºç»„ä»¶,å®ç°ç±»å¾ˆå¤šï¼Œåœ¨äºæ”¹å˜åŸæœ‰å¯¹è±¡</p>\n<p>âœ¨InitializingBeanï¼š ç»„ä»¶åˆå§‹åŒ–ä¹‹åè¿›è¡Œåç»­å¢å¼ºï¼Œä¸BeanPostProcessorä¸ç”¨çš„æ˜¯ï¼ŒInitializingBeanåœ¨äºé¢å¤–å¤„ç†ï¼Œå› ä¸ºè¿™é‡Œä¸ä¼šä¼ å…¥å½“å‰å¯¹è±¡çš„ä»»ä½•é¢å¤–ä¿¡æ¯</p>\n<p> å®é™…å·¥ä½œé¢è¯•ä¸­ï¼Œè€ƒå¯Ÿå¯¹Springçš„äº†è§£ç¨‹åº¦ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯å¯¹å¤šå°‘ç§å¤„ç†å™¨äº†è§£</p>\n<h1 id=\"å‡†å¤‡å·¥ä½œ\"><a href=\"#å‡†å¤‡å·¥ä½œ\" class=\"headerlink\" title=\"å‡†å¤‡å·¥ä½œ\"></a>å‡†å¤‡å·¥ä½œ</h1><p>æˆ‘ä»¬è¿™é‡Œå»å®ç°äº†è®¸å¤šçš„PostProcessorï¼Œä¾æ¬¡æ‰“å…¥æ–­ç‚¹è¿˜æ˜¯æºå¤´æ‰“å…¥æ–­ç‚¹è°ƒè¯•å †æ ˆä¿¡æ¯</p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Cat</span> <span class=\"token punctuation\">&#123;</span>\n\n   <span class=\"token keyword\">public</span> <span class=\"token class-name\">Cat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çŒ«è¢«åˆ›å»ºäº†\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyBeanPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">BeanPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">MyBeanPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyBeanPostProcessor  æ„é€ å™¨æ‰§è¡Œ.....\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">postProcessBeforeInitialization</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyBeanPostProcessor.postProcessBeforeInitialization .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> bean<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">postProcessAfterInitialization</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyBeanPostProcessor.postProcessAfterInitialization .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> bean<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyInitializingBean</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InitializingBean</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyInitializingBean.afterPropertiesSet .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyInstantiationAwareBeanPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InstantiationAwareBeanPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">MyInstantiationAwareBeanPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyInstantiationAwareBeanPostProcessor  æ„é€ å™¨æ‰§è¡Œ.....\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">postProcessBeforeInstantiation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> beanClass<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyInstantiationAwareBeanPostProcessor.postProcessBeforeInstantiation .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">postProcessAfterInstantiation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyInstantiationAwareBeanPostProcessor.postProcessAfterInstantiation .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">PropertyValues</span> <span class=\"token function\">postProcessProperties</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PropertyValues</span> pvs<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyInstantiationAwareBeanPostProcessor.postProcessProperties .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyMergedBeanDefinitionPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">MergedBeanDefinitionPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">MyMergedBeanDefinitionPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyMergedBeanDefinitionPostProcessor  æ„é€ å™¨æ‰§è¡Œ.....\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">postProcessBeforeInitialization</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyMergedBeanDefinitionPostProcessor.postProcessBeforeInitialization .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">postProcessAfterInitialization</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyMergedBeanDefinitionPostProcessor.postProcessAfterInitialization .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">postProcessMergedBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RootBeanDefinition</span> beanDefinition<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> beanType<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyMergedBeanDefinitionPostProcessor.postProcessMergedBeanDefinition .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">resetBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyMergedBeanDefinitionPostProcessor.resetBeanDefinition .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MySmartInstantiationAwareBeanPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">SmartInstantiationAwareBeanPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">predictBeanType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> beanClass<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MySmartInstantiationAwareBeanPostProcessor.predictBeanType .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Constructor</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">determineCandidateConstructors</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> beanClass<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MySmartInstantiationAwareBeanPostProcessor.determineCandidateConstructors .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Constructor</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getEarlyBeanReference</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MySmartInstantiationAwareBeanPostProcessor.getEarlyBeanReference .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyBeanDefinitionRegistryPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">postProcessBeanFactory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyBeanDefinitionRegistryPostProcessor postProcessBeanFactory .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">postProcessBeanDefinitionRegistry</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyBeanDefinitionRegistryPostProcessor postProcessBeanDefinitionRegistry .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyBeanFactoryPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">BeanFactoryPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">postProcessBeanFactory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyBeanFactoryPostProcessor postProcessBeanFactory .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>\n\n<p>ä½¿ç”¨ ComponentScan æ¥æ‰«ææ³¨è§£@Componment</p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ComponentScan</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cn.hyqup.spring\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainConfig</span> <span class=\"token punctuation\">&#123;</span>\n\n\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AnnotationMainTest</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">ApplicationContext</span> applicationContext <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnnotationConfigApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MainConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">Cat</span> bean <span class=\"token operator\">=</span> applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Cat</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>bean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>\n\n<h1 id=\"å †æ ˆåˆ†æ\"><a href=\"#å †æ ˆåˆ†æ\" class=\"headerlink\" title=\"å †æ ˆåˆ†æ\"></a>å †æ ˆåˆ†æ</h1><h2 id=\"ç±»å‹ä¸€ï¼šBeanFactoryPostProcessorç±»å‹çš„å·¥å‚åç½®å¤„ç†å™¨\"><a href=\"#ç±»å‹ä¸€ï¼šBeanFactoryPostProcessorç±»å‹çš„å·¥å‚åç½®å¤„ç†å™¨\" class=\"headerlink\" title=\"ç±»å‹ä¸€ï¼šBeanFactoryPostProcessorç±»å‹çš„å·¥å‚åç½®å¤„ç†å™¨\"></a>ç±»å‹ä¸€ï¼šBeanFactoryPostProcessorç±»å‹çš„å·¥å‚åç½®å¤„ç†å™¨</h2><h3 id=\"BeanFactoryPostProcessor-ä»£ç å…¥å£\"><a href=\"#BeanFactoryPostProcessor-ä»£ç å…¥å£\" class=\"headerlink\" title=\"BeanFactoryPostProcessor ä»£ç å…¥å£\"></a>BeanFactoryPostProcessor ä»£ç å…¥å£</h3><h4 id=\"AnnotationConfigApplicationContext-refreshï¼ˆï¼‰\"><a href=\"#AnnotationConfigApplicationContext-refreshï¼ˆï¼‰\" class=\"headerlink\" title=\"AnnotationConfigApplicationContext refreshï¼ˆï¼‰\"></a>AnnotationConfigApplicationContext refreshï¼ˆï¼‰</h4><figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IllegalStateException</span> <span class=\"token punctuation\">&#123;</span>\n   <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startupShutdownMonitor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">StartupStep</span> contextRefresh <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>applicationStartup<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"spring.context.refresh\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Prepare this context for refreshing.</span>\n      <span class=\"token function\">prepareRefresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Tell the subclass to refresh the internal bean factory.</span>\n      <span class=\"token comment\">//å‘Šè¯‰å­ç±»åˆ·æ–°å†…éƒ¨ bean å·¥å‚ã€‚</span>\n      <span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory <span class=\"token operator\">=</span> <span class=\"token function\">obtainFreshBeanFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Prepare the bean factory for use in this context.</span>\n      <span class=\"token function\">prepareBeanFactory</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token comment\">// Allows post-processing of the bean factory in context subclasses.</span>\n         <span class=\"token function\">postProcessBeanFactory</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token class-name\">StartupStep</span> beanPostProcess <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>applicationStartup<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"spring.context.beans.post-process\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token comment\">// Invoke factory processors registered as beans in the context.</span>\n         <span class=\"token comment\">// æ‰§è¡Œæ‰€æœ‰çš„ BeanFactoryPostProcessorï¼Œç†ç”±BeanFactoryåç½®å¢å¼ºå™¨å¯¹å·¥å‚è¿›è¡Œä¿®æ”¹æˆ–å¢å¼º</span>\n         <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Register bean processors that intercept bean creation.</span>\n         <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         beanPostProcess<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Initialize message source for this context.</span>\n         <span class=\"token function\">initMessageSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Initialize event multicaster for this context.</span>\n         <span class=\"token function\">initApplicationEventMulticaster</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Initialize other special beans in specific context subclasses.</span>\n         <span class=\"token function\">onRefresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Check for listener beans and register them.</span>\n         <span class=\"token function\">registerListeners</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Instantiate all remaining (non-lazy-init) singletons.</span>\n         <span class=\"token comment\">// å®ŒæˆBean å·¥å‚çš„åˆå§‹åŒ–</span>\n         <span class=\"token function\">finishBeanFactoryInitialization</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Last step: publish corresponding event.</span>\n         <span class=\"token function\">finishRefresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">BeansException</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">isWarnEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            logger<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Exception encountered during context initialization - \"</span> <span class=\"token operator\">+</span>\n                  <span class=\"token string\">\"cancelling refresh attempt: \"</span> <span class=\"token operator\">+</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n\n         <span class=\"token comment\">// Destroy already created singletons to avoid dangling resources.</span>\n         <span class=\"token function\">destroyBeans</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Reset 'active' flag.</span>\n         <span class=\"token function\">cancelRefresh</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Propagate exception to caller.</span>\n         <span class=\"token keyword\">throw</span> ex<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token comment\">// Reset common introspection caches in Spring's core, since we</span>\n         <span class=\"token comment\">// might not ever need metadata for singleton beans anymore...</span>\n         <span class=\"token function\">resetCommonCaches</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         contextRefresh<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>\n\n<p>invokeBeanFactoryPostProcessors ä¸ºBeanFactoryPostProcessorsæ ¸å¿ƒå…¥å£æ–¹æ³•ï¼Œå‘ç”Ÿåœ¨BeanFactoryåˆ›å»ºä¹‹å</p>\n<h3 id=\"BeanFactoryPostProcessoræ³¨å†Œ\"><a href=\"#BeanFactoryPostProcessoræ³¨å†Œ\" class=\"headerlink\" title=\"BeanFactoryPostProcessoræ³¨å†Œ\"></a>BeanFactoryPostProcessoræ³¨å†Œ</h3><h4 id=\"refresh-ä¸­çš„-invokeBeanFactoryPostProcessors-æ–¹æ³•å°±æ˜¯æ‰§è¡Œæ‰€æœ‰BeanFactory-åç½®å¢å¼ºå™¨\"><a href=\"#refresh-ä¸­çš„-invokeBeanFactoryPostProcessors-æ–¹æ³•å°±æ˜¯æ‰§è¡Œæ‰€æœ‰BeanFactory-åç½®å¢å¼ºå™¨\" class=\"headerlink\" title=\"refresh() ä¸­çš„ invokeBeanFactoryPostProcessors æ–¹æ³•å°±æ˜¯æ‰§è¡Œæ‰€æœ‰BeanFactory åç½®å¢å¼ºå™¨\"></a>refresh() ä¸­çš„ invokeBeanFactoryPostProcessors æ–¹æ³•å°±æ˜¯æ‰§è¡Œæ‰€æœ‰BeanFactory åç½®å¢å¼ºå™¨</h4><figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n   <span class=\"token class-name\">PostProcessorRegistrationDelegate</span><span class=\"token punctuation\">.</span><span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> <span class=\"token function\">getBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime</span>\n   <span class=\"token comment\">// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)</span>\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">NativeDetector</span><span class=\"token punctuation\">.</span><span class=\"token function\">inNativeImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getTempClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">containsBean</span><span class=\"token punctuation\">(</span><span class=\"token constant\">LOAD_TIME_WEAVER_BEAN_NAME</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">addBeanPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LoadTimeWeaverAwareProcessor</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setTempClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ContextTypeMatchClassLoader</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>\n\n<h3 id=\"BeanFactoryPostProcessoræ‰§è¡Œ\"><a href=\"#BeanFactoryPostProcessoræ‰§è¡Œ\" class=\"headerlink\" title=\"BeanFactoryPostProcessoræ‰§è¡Œ\"></a>BeanFactoryPostProcessoræ‰§è¡Œ</h3><h4 id=\"æ‰§è¡ŒinvokeBeanFactoryPostProcessors-æ ¸å¿ƒé€»è¾‘\"><a href=\"#æ‰§è¡ŒinvokeBeanFactoryPostProcessors-æ ¸å¿ƒé€»è¾‘\" class=\"headerlink\" title=\"æ‰§è¡ŒinvokeBeanFactoryPostProcessors æ ¸å¿ƒé€»è¾‘\"></a>æ‰§è¡ŒinvokeBeanFactoryPostProcessors æ ¸å¿ƒé€»è¾‘</h4><figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>\n      <span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">></span></span> beanFactoryPostProcessors<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n   <span class=\"token comment\">// WARNING: Although it may appear that the body of this method can be easily</span>\n   <span class=\"token comment\">// refactored to avoid the use of multiple loops and multiple lists, the use</span>\n   <span class=\"token comment\">// of multiple lists and multiple passes over the names of processors is</span>\n   <span class=\"token comment\">// intentional. We must ensure that we honor the contracts for PriorityOrdered</span>\n   <span class=\"token comment\">// and Ordered processors. Specifically, we must NOT cause processors to be</span>\n   <span class=\"token comment\">// instantiated (via getBean() invocations) or registered in the ApplicationContext</span>\n   <span class=\"token comment\">// in the wrong order.</span>\n   <span class=\"token comment\">//</span>\n   <span class=\"token comment\">// Before submitting a pull request (PR) to change this method, please review the</span>\n   <span class=\"token comment\">// list of all declined PRs involving changes to PostProcessorRegistrationDelegate</span>\n   <span class=\"token comment\">// to ensure that your proposal does not result in a breaking change:</span>\n   <span class=\"token comment\">// https://github.com/spring-projects/spring-framework/issues?q=PostProcessorRegistrationDelegate+is%3Aclosed+label%3A%22status%3A+declined%22</span>\n\n   <span class=\"token comment\">// Invoke BeanDefinitionRegistryPostProcessors first, if any.</span>\n   <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> processedBeans <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">BeanDefinitionRegistry</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">BeanDefinitionRegistry</span> registry <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistry</span><span class=\"token punctuation\">)</span> beanFactory<span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">></span></span> regularPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">></span></span> registryProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanFactoryPostProcessor</span> postProcessor <span class=\"token operator\">:</span> beanFactoryPostProcessors<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>postProcessor <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span> registryProcessor <span class=\"token operator\">=</span>\n                  <span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">)</span> postProcessor<span class=\"token punctuation\">;</span>\n            registryProcessor<span class=\"token punctuation\">.</span><span class=\"token function\">postProcessBeanDefinitionRegistry</span><span class=\"token punctuation\">(</span>registry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            registryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>registryProcessor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n            regularPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>postProcessor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token comment\">// Do not initialize FactoryBeans here: We need to leave all regular beans</span>\n      <span class=\"token comment\">// uninitialized to let the bean factory post-processors apply to them!</span>\n      <span class=\"token comment\">// Separate between BeanDefinitionRegistryPostProcessors that implement</span>\n      <span class=\"token comment\">// PriorityOrdered, Ordered, and the rest.</span>\n      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">></span></span> currentRegistryProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// First, invoke the BeanDefinitionRegistryPostProcessors that implement PriorityOrdered.</span>\n\n      <span class=\"token comment\">//é¦–å…ˆï¼Œè°ƒç”¨å®ç° PriorityOrdered çš„ BeanDefinitionRegistryPostProcessor</span>\n      <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> postProcessorNames <span class=\"token operator\">=</span>\n            beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanNamesForType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> postProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦å®ç°äº†é¡ºåºæ¥å£ï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span>\n         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PriorityOrdered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">// ä»å®¹å™¨ä¸­è·å–è¿™ä¸ªç»„ä»¶ï¼Œå¹¶æ”¾åˆ°è¯¥é›†åˆï¼ŒgetBean æ²¡æœ‰åˆ™ä¼šå»åˆ›å»º</span>\n            currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      registryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// æ‰§è¡Œ å½“å‰æ¥å£çš„postProcessBeanDefinitionRegistry</span>\n      <span class=\"token function\">invokeBeanDefinitionRegistryPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> registry<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getApplicationStartup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Next, invoke the BeanDefinitionRegistryPostProcessors that implement Ordered.</span>\n      postProcessorNames <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanNamesForType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> postProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Ordered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      registryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">invokeBeanDefinitionRegistryPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> registry<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getApplicationStartup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Finally, invoke all other BeanDefinitionRegistryPostProcessors until no further ones appear.</span>\n      <span class=\"token keyword\">boolean</span> reiterate <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>reiterate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         reiterate <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n         postProcessorNames <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanNamesForType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> postProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n               currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n               processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n               reiterate <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         registryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token function\">invokeBeanDefinitionRegistryPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> registry<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getApplicationStartup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token comment\">// Now, invoke the postProcessBeanFactory callback of all processors handled so far.</span>\n      <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>registryProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>regularPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n\n   <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token comment\">// Invoke factory processors registered with the context instance.</span>\n      <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>beanFactoryPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n\n   <span class=\"token comment\">// Do not initialize FactoryBeans here: We need to leave all regular beans</span>\n   <span class=\"token comment\">// uninitialized to let the bean factory post-processors apply to them!</span>\n   <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> postProcessorNames <span class=\"token operator\">=</span>\n         beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanNamesForType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Separate between BeanFactoryPostProcessors that implement PriorityOrdered,</span>\n   <span class=\"token comment\">// Ordered, and the rest.</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">></span></span> priorityOrderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> orderedPostProcessorNames <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> nonOrderedPostProcessorNames <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> postProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token comment\">// skip - already processed in first phase above</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PriorityOrdered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         priorityOrderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Ordered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         orderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n         nonOrderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n\n   <span class=\"token comment\">// First, invoke the BeanFactoryPostProcessors that implement PriorityOrdered.</span>\n   <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>priorityOrderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>priorityOrderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Next, invoke the BeanFactoryPostProcessors that implement Ordered.</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">></span></span> orderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>orderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> postProcessorName <span class=\"token operator\">:</span> orderedPostProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      orderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>postProcessorName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>orderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>orderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Finally, invoke all other BeanFactoryPostProcessors.</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">></span></span> nonOrderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>nonOrderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> postProcessorName <span class=\"token operator\">:</span> nonOrderedPostProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      nonOrderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>postProcessorName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>nonOrderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Clear cached merged bean definitions since the post-processors might have</span>\n   <span class=\"token comment\">// modified the original metadata, e.g. replacing placeholders in values...</span>\n   beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">clearMetadataCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>\n\n<p>è¿™é‡Œé¦–å…ˆä¼šåˆ¤æ–­ æ˜¯å¦å®ç°BeanDefinitionRegistry æ¥å£ã€‚</p>\n<p>é‡Œé¢åˆ†ä¸‰ç§ </p>\n<p>1ã€å®ç° PriorityOrdered é¡ºåºä¼˜å…ˆçº§æœ€é«˜</p>\n<p>2ã€Orderedé¡ºåºï¼Œä½äºPriorityOrdered </p>\n<p>3ã€æ™®é€šæœªå®ç°é¡ºåºæ¥å£</p>\n<p>æŒ‰ç…§è¿™æ ·çš„é¡ºåºå»è°ƒç”¨ invokeBeanFactoryPostProcessors ï¼Œå°±æ˜¯æ¥å£çš„æ ¹æ–¹æ³•</p>\n<p>é¡ºåºéƒ½æ˜¯æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</p>\n<p>invokeBeanFactoryPostProcessors ä¸­ä¼šå¾ªç¯è°ƒç”¨ç›¸å…³æ¥å£çš„æ–¹æ³•</p>\n<h3 id=\"å®ä¾‹åˆ†æ\"><a href=\"#å®ä¾‹åˆ†æ\" class=\"headerlink\" title=\"å®ä¾‹åˆ†æ\"></a>å®ä¾‹åˆ†æ</h3><h4 id=\"ConfigurationClassPostProcessor\"><a href=\"#ConfigurationClassPostProcessor\" class=\"headerlink\" title=\"ConfigurationClassPostProcessor\"></a>ConfigurationClassPostProcessor</h4><p>å°±æ˜¯é€šè¿‡å®ç°BeanDefinitionRegistryPostProcessorï¼Œæ‰«æé…ç½®ç±»åŠå…¶ç›¸å…³æ³¨è§£ï¼Œå¦‚@Componment @componmentScan æ¥å°†è¿™äº›ä¿¡æ¯å°è£…ä¸ºBeanDefinitionä»¥ä¾›åç»­åˆ›å»ºbeançš„å®šä¹‰ä¿¡æ¯</p>\n<h2 id=\"ç±»å‹äºŒï¼šBeanPostProcessorç±»å‹ä¸ºBeançš„åç½®å¤„ç†å™¨å¢å¼º\"><a href=\"#ç±»å‹äºŒï¼šBeanPostProcessorç±»å‹ä¸ºBeançš„åç½®å¤„ç†å™¨å¢å¼º\" class=\"headerlink\" title=\"ç±»å‹äºŒï¼šBeanPostProcessorç±»å‹ä¸ºBeançš„åç½®å¤„ç†å™¨å¢å¼º\"></a>ç±»å‹äºŒï¼šBeanPostProcessorç±»å‹ä¸ºBeançš„åç½®å¤„ç†å™¨å¢å¼º</h2><h3 id=\"BeanPostProcessorçš„æ³¨å†Œ\"><a href=\"#BeanPostProcessorçš„æ³¨å†Œ\" class=\"headerlink\" title=\"BeanPostProcessorçš„æ³¨å†Œ\"></a>BeanPostProcessorçš„æ³¨å†Œ</h3><p>refreshï¼ˆï¼‰æ–¹æ³•ä¸­çš„registerBeanPostProcessorsï¼ˆbeanFactoryï¼‰ å…¥å£</p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>\n      <span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AbstractApplicationContext</span> applicationContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n   <span class=\"token comment\">// WARNING: Although it may appear that the body of this method can be easily</span>\n   <span class=\"token comment\">// refactored to avoid the use of multiple loops and multiple lists, the use</span>\n   <span class=\"token comment\">// of multiple lists and multiple passes over the names of processors is</span>\n   <span class=\"token comment\">// intentional. We must ensure that we honor the contracts for PriorityOrdered</span>\n   <span class=\"token comment\">// and Ordered processors. Specifically, we must NOT cause processors to be</span>\n   <span class=\"token comment\">// instantiated (via getBean() invocations) or registered in the ApplicationContext</span>\n   <span class=\"token comment\">// in the wrong order.</span>\n   <span class=\"token comment\">//</span>\n   <span class=\"token comment\">// Before submitting a pull request (PR) to change this method, please review the</span>\n   <span class=\"token comment\">// list of all declined PRs involving changes to PostProcessorRegistrationDelegate</span>\n   <span class=\"token comment\">// to ensure that your proposal does not result in a breaking change:</span>\n   <span class=\"token comment\">// https://github.com/spring-projects/spring-framework/issues?q=PostProcessorRegistrationDelegate+is%3Aclosed+label%3A%22status%3A+declined%22</span>\n\n   <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> postProcessorNames <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanNamesForType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Register BeanPostProcessorChecker that logs an info message when</span>\n   <span class=\"token comment\">// a bean is created during BeanPostProcessor instantiation, i.e. when</span>\n   <span class=\"token comment\">// a bean is not eligible for getting processed by all BeanPostProcessors.</span>\n   <span class=\"token keyword\">int</span> beanProcessorTargetCount <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanPostProcessorCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> postProcessorNames<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n   beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">addBeanPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanPostProcessorChecker</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> beanProcessorTargetCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Separate between BeanPostProcessors that implement PriorityOrdered,</span>\n   <span class=\"token comment\">// Ordered, and the rest.</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">></span></span> priorityOrderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">></span></span> internalPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> orderedPostProcessorNames <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> nonOrderedPostProcessorNames <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> postProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token comment\">// è·å–æ‰€æœ‰å®ç° PriorityOrdered</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PriorityOrdered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token class-name\">BeanPostProcessor</span> pp <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         priorityOrderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token comment\">//  å†…éƒ¨çš„</span>\n         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pp <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">MergedBeanDefinitionPostProcessor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            internalPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Ordered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         orderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n         nonOrderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n\n   <span class=\"token comment\">// First, register the BeanPostProcessors that implement PriorityOrdered.</span>\n\n   <span class=\"token comment\">//é¦–å…ˆï¼Œæ³¨å†Œå®ç° PriorityOrdered çš„ BeanPostProcessorã€‚</span>\n   <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>priorityOrderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> priorityOrderedPostProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Next, register the BeanPostProcessors that implement Ordered.</span>\n   <span class=\"token comment\">// æ¥ä¸‹æ¥ï¼Œæ³¨å†Œå®ç° Ordered çš„ BeanPostProcessorã€‚</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">></span></span> orderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>orderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> orderedPostProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">BeanPostProcessor</span> pp <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      orderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pp <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">MergedBeanDefinitionPostProcessor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         internalPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>orderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> orderedPostProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Now, register all regular BeanPostProcessors.</span>\n   <span class=\"token comment\">// ç°åœ¨ï¼Œæ³¨å†Œæ‰€æœ‰å¸¸è§„çš„ BeanPostProcessorã€‚ getBean</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">></span></span> nonOrderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>nonOrderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> nonOrderedPostProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">BeanPostProcessor</span> pp <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      nonOrderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pp <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">MergedBeanDefinitionPostProcessor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         internalPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> nonOrderedPostProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Finally, re-register all internal BeanPostProcessors.</span>\n   <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>internalPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> internalPostProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Re-register post-processor for detecting inner beans as ApplicationListeners,</span>\n   <span class=\"token comment\">// moving it to the end of the processor chain (for picking up proxies etc).</span>\n   beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">addBeanPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ApplicationListenerDetector</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>\n\n<p>æµç¨‹å¦‚ä¸Šï¼Œå’ŒBeanFactoryPostProcessor å¤§è‡´é€»è¾‘ç±»ä¼¼æ•´ä¸ªæµç¨‹å®Œæˆæ³¨å†Œ</p>\n<h3 id=\"BeanPostProcessoræ‰§è¡Œ\"><a href=\"#BeanPostProcessoræ‰§è¡Œ\" class=\"headerlink\" title=\"BeanPostProcessoræ‰§è¡Œ\"></a>BeanPostProcessoræ‰§è¡Œ</h3><blockquote>\n<p>ç”±äºå„ç§ç±»å‹çš„BeanPostProcessoråœ¨Beançš„ç”Ÿå‘½å‘¨æœŸå¹²æ‰°çš„æ—¶æœºä¸åŒï¼Œæ‰€ä»¥æ‰§è¡Œçš„æ—¶æœºä¹Ÿæ˜¯ä¸åŒçš„ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼šåˆ†åˆ«é’ˆå¯¹å„ä¸ªå­ç±»BeanPostProcessoræ¥å£ä»£ç åˆ†æå¹²æ‰°çš„æ—¶æœº</p>\n</blockquote>\n<h4 id=\"SmartInstantiationAwareBeanPostProcessor\"><a href=\"#SmartInstantiationAwareBeanPostProcessor\" class=\"headerlink\" title=\"SmartInstantiationAwareBeanPostProcessor\"></a>SmartInstantiationAwareBeanPostProcessor</h4><h4 id=\"InstantiationAwareBeanPostProcessor\"><a href=\"#InstantiationAwareBeanPostProcessor\" class=\"headerlink\" title=\"InstantiationAwareBeanPostProcessor\"></a>InstantiationAwareBeanPostProcessor</h4><h4 id=\"MergedBeanDefinitionPostProcessor\"><a href=\"#MergedBeanDefinitionPostProcessor\" class=\"headerlink\" title=\"MergedBeanDefinitionPostProcessor\"></a>MergedBeanDefinitionPostProcessor</h4><h2 id=\"ç±»å‹ä¸‰ï¼šInitializingBean-å®Œæˆbean-åˆå§‹åŒ–åçš„æ“ä½œ\"><a href=\"#ç±»å‹ä¸‰ï¼šInitializingBean-å®Œæˆbean-åˆå§‹åŒ–åçš„æ“ä½œ\" class=\"headerlink\" title=\"ç±»å‹ä¸‰ï¼šInitializingBean å®Œæˆbean åˆå§‹åŒ–åçš„æ“ä½œ\"></a>ç±»å‹ä¸‰ï¼šInitializingBean å®Œæˆbean åˆå§‹åŒ–åçš„æ“ä½œ</h2><p>å †æ ˆæ–¹æ³•è¿½è¸ªï¼šgetBean-&gt;doGetBean-&gt;getSingleton-&gt;createBean-&gt;doCreateBean-&gt;initializeBean-&gt;invokeInitMethods  </p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">invokeInitMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Nullable</span> <span class=\"token class-name\">RootBeanDefinition</span> mbd<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span> <span class=\"token punctuation\">&#123;</span>\n\n   <span class=\"token keyword\">boolean</span> isInitializingBean <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>bean <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">InitializingBean</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isInitializingBean <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>mbd <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>mbd<span class=\"token punctuation\">.</span><span class=\"token function\">isExternallyManagedInitMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"afterPropertiesSet\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">isTraceEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         logger<span class=\"token punctuation\">.</span><span class=\"token function\">trace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invoking afterPropertiesSet() on bean with name '\"</span> <span class=\"token operator\">+</span> beanName <span class=\"token operator\">+</span> <span class=\"token string\">\"'\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSecurityManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token class-name\">AccessController</span><span class=\"token punctuation\">.</span><span class=\"token function\">doPrivileged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PrivilegedExceptionAction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span>\n               <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InitializingBean</span><span class=\"token punctuation\">)</span> bean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n               <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getAccessControlContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">PrivilegedActionException</span> pae<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">throw</span> pae<span class=\"token punctuation\">.</span><span class=\"token function\">getException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InitializingBean</span><span class=\"token punctuation\">)</span> bean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mbd <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> bean<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token class-name\">NullBean</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">String</span> initMethodName <span class=\"token operator\">=</span> mbd<span class=\"token punctuation\">.</span><span class=\"token function\">getInitMethodName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasLength</span><span class=\"token punctuation\">(</span>initMethodName<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n            <span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>isInitializingBean <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">\"afterPropertiesSet\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>initMethodName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n            <span class=\"token operator\">!</span>mbd<span class=\"token punctuation\">.</span><span class=\"token function\">isExternallyManagedInitMethod</span><span class=\"token punctuation\">(</span>initMethodName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token function\">invokeCustomInitMethod</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> bean<span class=\"token punctuation\">,</span> mbd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>\n\n<p>bean å®Œæˆä¹‹åä¼šæ‰§è¡ŒInitializingBean.afterPropertiesSet</p>\n<h2 id=\"æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæµç¨‹åç½®å¤„ç†å™¨å¹²æ‰°å›¾\"><a href=\"#æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæµç¨‹åç½®å¤„ç†å™¨å¹²æ‰°å›¾\" class=\"headerlink\" title=\"æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæµç¨‹åç½®å¤„ç†å™¨å¹²æ‰°å›¾\"></a>æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæµç¨‹åç½®å¤„ç†å™¨å¹²æ‰°å›¾</h2><p><img src=\"http://hyqup-blog-upyun.test.upcdn.net/img/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%A2%9E%E5%BC%BA%E5%99%A8.drawio.png\"></p>\n","more":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ğŸ‰BeanFactoryPostProcessorï¼šåç½®å¢å¼ºå·¥å‚</p>\n<p>ğŸ¨BeanPostProcessor: åç½®å¢å¼ºç»„ä»¶,å®ç°ç±»å¾ˆå¤šï¼Œåœ¨äºæ”¹å˜åŸæœ‰å¯¹è±¡</p>\n<p>âœ¨InitializingBeanï¼š ç»„ä»¶åˆå§‹åŒ–ä¹‹åè¿›è¡Œåç»­å¢å¼ºï¼Œä¸BeanPostProcessorä¸ç”¨çš„æ˜¯ï¼ŒInitializingBeanåœ¨äºé¢å¤–å¤„ç†ï¼Œå› ä¸ºè¿™é‡Œä¸ä¼šä¼ å…¥å½“å‰å¯¹è±¡çš„ä»»ä½•é¢å¤–ä¿¡æ¯</p>\n<p> å®é™…å·¥ä½œé¢è¯•ä¸­ï¼Œè€ƒå¯Ÿå¯¹Springçš„äº†è§£ç¨‹åº¦ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯å¯¹å¤šå°‘ç§å¤„ç†å™¨äº†è§£</p>\n<h1 id=\"å‡†å¤‡å·¥ä½œ\"><a href=\"#å‡†å¤‡å·¥ä½œ\" class=\"headerlink\" title=\"å‡†å¤‡å·¥ä½œ\"></a>å‡†å¤‡å·¥ä½œ</h1><p>æˆ‘ä»¬è¿™é‡Œå»å®ç°äº†è®¸å¤šçš„PostProcessorï¼Œä¾æ¬¡æ‰“å…¥æ–­ç‚¹è¿˜æ˜¯æºå¤´æ‰“å…¥æ–­ç‚¹è°ƒè¯•å †æ ˆä¿¡æ¯</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Cat</span> <span class=\"token punctuation\">&#123;</span>\n\n   <span class=\"token keyword\">public</span> <span class=\"token class-name\">Cat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çŒ«è¢«åˆ›å»ºäº†\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyBeanPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">BeanPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">MyBeanPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyBeanPostProcessor  æ„é€ å™¨æ‰§è¡Œ.....\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">postProcessBeforeInitialization</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyBeanPostProcessor.postProcessBeforeInitialization .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> bean<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">postProcessAfterInitialization</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyBeanPostProcessor.postProcessAfterInitialization .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> bean<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyInitializingBean</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InitializingBean</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyInitializingBean.afterPropertiesSet .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyInstantiationAwareBeanPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InstantiationAwareBeanPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">MyInstantiationAwareBeanPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyInstantiationAwareBeanPostProcessor  æ„é€ å™¨æ‰§è¡Œ.....\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">postProcessBeforeInstantiation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> beanClass<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyInstantiationAwareBeanPostProcessor.postProcessBeforeInstantiation .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">postProcessAfterInstantiation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyInstantiationAwareBeanPostProcessor.postProcessAfterInstantiation .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">PropertyValues</span> <span class=\"token function\">postProcessProperties</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PropertyValues</span> pvs<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyInstantiationAwareBeanPostProcessor.postProcessProperties .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyMergedBeanDefinitionPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">MergedBeanDefinitionPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">MyMergedBeanDefinitionPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyMergedBeanDefinitionPostProcessor  æ„é€ å™¨æ‰§è¡Œ.....\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">postProcessBeforeInitialization</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyMergedBeanDefinitionPostProcessor.postProcessBeforeInitialization .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">postProcessAfterInitialization</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyMergedBeanDefinitionPostProcessor.postProcessAfterInitialization .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">postProcessMergedBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RootBeanDefinition</span> beanDefinition<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> beanType<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyMergedBeanDefinitionPostProcessor.postProcessMergedBeanDefinition .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">resetBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyMergedBeanDefinitionPostProcessor.resetBeanDefinition .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MySmartInstantiationAwareBeanPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">SmartInstantiationAwareBeanPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">predictBeanType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> beanClass<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MySmartInstantiationAwareBeanPostProcessor.predictBeanType .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Constructor</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">determineCandidateConstructors</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> beanClass<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MySmartInstantiationAwareBeanPostProcessor.determineCandidateConstructors .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Constructor</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getEarlyBeanReference</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MySmartInstantiationAwareBeanPostProcessor.getEarlyBeanReference .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyBeanDefinitionRegistryPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">postProcessBeanFactory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyBeanDefinitionRegistryPostProcessor postProcessBeanFactory .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">postProcessBeanDefinitionRegistry</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyBeanDefinitionRegistryPostProcessor postProcessBeanDefinitionRegistry .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyBeanFactoryPostProcessor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">BeanFactoryPostProcessor</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">postProcessBeanFactory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰§è¡Œ MyBeanFactoryPostProcessor postProcessBeanFactory .....................\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>ä½¿ç”¨ ComponentScan æ¥æ‰«ææ³¨è§£@Componment</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ComponentScan</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cn.hyqup.spring\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainConfig</span> <span class=\"token punctuation\">&#123;</span>\n\n\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AnnotationMainTest</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">ApplicationContext</span> applicationContext <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnnotationConfigApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MainConfig</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">Cat</span> bean <span class=\"token operator\">=</span> applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Cat</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>bean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"å †æ ˆåˆ†æ\"><a href=\"#å †æ ˆåˆ†æ\" class=\"headerlink\" title=\"å †æ ˆåˆ†æ\"></a>å †æ ˆåˆ†æ</h1><h2 id=\"ç±»å‹ä¸€ï¼šBeanFactoryPostProcessorç±»å‹çš„å·¥å‚åç½®å¤„ç†å™¨\"><a href=\"#ç±»å‹ä¸€ï¼šBeanFactoryPostProcessorç±»å‹çš„å·¥å‚åç½®å¤„ç†å™¨\" class=\"headerlink\" title=\"ç±»å‹ä¸€ï¼šBeanFactoryPostProcessorç±»å‹çš„å·¥å‚åç½®å¤„ç†å™¨\"></a>ç±»å‹ä¸€ï¼šBeanFactoryPostProcessorç±»å‹çš„å·¥å‚åç½®å¤„ç†å™¨</h2><h3 id=\"BeanFactoryPostProcessor-ä»£ç å…¥å£\"><a href=\"#BeanFactoryPostProcessor-ä»£ç å…¥å£\" class=\"headerlink\" title=\"BeanFactoryPostProcessor ä»£ç å…¥å£\"></a>BeanFactoryPostProcessor ä»£ç å…¥å£</h3><h4 id=\"AnnotationConfigApplicationContext-refreshï¼ˆï¼‰\"><a href=\"#AnnotationConfigApplicationContext-refreshï¼ˆï¼‰\" class=\"headerlink\" title=\"AnnotationConfigApplicationContext refreshï¼ˆï¼‰\"></a>AnnotationConfigApplicationContext refreshï¼ˆï¼‰</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IllegalStateException</span> <span class=\"token punctuation\">&#123;</span>\n   <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startupShutdownMonitor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">StartupStep</span> contextRefresh <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>applicationStartup<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"spring.context.refresh\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Prepare this context for refreshing.</span>\n      <span class=\"token function\">prepareRefresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Tell the subclass to refresh the internal bean factory.</span>\n      <span class=\"token comment\">//å‘Šè¯‰å­ç±»åˆ·æ–°å†…éƒ¨ bean å·¥å‚ã€‚</span>\n      <span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory <span class=\"token operator\">=</span> <span class=\"token function\">obtainFreshBeanFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Prepare the bean factory for use in this context.</span>\n      <span class=\"token function\">prepareBeanFactory</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token comment\">// Allows post-processing of the bean factory in context subclasses.</span>\n         <span class=\"token function\">postProcessBeanFactory</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token class-name\">StartupStep</span> beanPostProcess <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>applicationStartup<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"spring.context.beans.post-process\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token comment\">// Invoke factory processors registered as beans in the context.</span>\n         <span class=\"token comment\">// æ‰§è¡Œæ‰€æœ‰çš„ BeanFactoryPostProcessorï¼Œç†ç”±BeanFactoryåç½®å¢å¼ºå™¨å¯¹å·¥å‚è¿›è¡Œä¿®æ”¹æˆ–å¢å¼º</span>\n         <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Register bean processors that intercept bean creation.</span>\n         <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         beanPostProcess<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Initialize message source for this context.</span>\n         <span class=\"token function\">initMessageSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Initialize event multicaster for this context.</span>\n         <span class=\"token function\">initApplicationEventMulticaster</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Initialize other special beans in specific context subclasses.</span>\n         <span class=\"token function\">onRefresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Check for listener beans and register them.</span>\n         <span class=\"token function\">registerListeners</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Instantiate all remaining (non-lazy-init) singletons.</span>\n         <span class=\"token comment\">// å®ŒæˆBean å·¥å‚çš„åˆå§‹åŒ–</span>\n         <span class=\"token function\">finishBeanFactoryInitialization</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Last step: publish corresponding event.</span>\n         <span class=\"token function\">finishRefresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">BeansException</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">isWarnEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            logger<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Exception encountered during context initialization - \"</span> <span class=\"token operator\">+</span>\n                  <span class=\"token string\">\"cancelling refresh attempt: \"</span> <span class=\"token operator\">+</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n\n         <span class=\"token comment\">// Destroy already created singletons to avoid dangling resources.</span>\n         <span class=\"token function\">destroyBeans</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Reset 'active' flag.</span>\n         <span class=\"token function\">cancelRefresh</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n         <span class=\"token comment\">// Propagate exception to caller.</span>\n         <span class=\"token keyword\">throw</span> ex<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token comment\">// Reset common introspection caches in Spring's core, since we</span>\n         <span class=\"token comment\">// might not ever need metadata for singleton beans anymore...</span>\n         <span class=\"token function\">resetCommonCaches</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         contextRefresh<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>invokeBeanFactoryPostProcessors ä¸ºBeanFactoryPostProcessorsæ ¸å¿ƒå…¥å£æ–¹æ³•ï¼Œå‘ç”Ÿåœ¨BeanFactoryåˆ›å»ºä¹‹å</p>\n<h3 id=\"BeanFactoryPostProcessoræ³¨å†Œ\"><a href=\"#BeanFactoryPostProcessoræ³¨å†Œ\" class=\"headerlink\" title=\"BeanFactoryPostProcessoræ³¨å†Œ\"></a>BeanFactoryPostProcessoræ³¨å†Œ</h3><h4 id=\"refresh-ä¸­çš„-invokeBeanFactoryPostProcessors-æ–¹æ³•å°±æ˜¯æ‰§è¡Œæ‰€æœ‰BeanFactory-åç½®å¢å¼ºå™¨\"><a href=\"#refresh-ä¸­çš„-invokeBeanFactoryPostProcessors-æ–¹æ³•å°±æ˜¯æ‰§è¡Œæ‰€æœ‰BeanFactory-åç½®å¢å¼ºå™¨\" class=\"headerlink\" title=\"refresh() ä¸­çš„ invokeBeanFactoryPostProcessors æ–¹æ³•å°±æ˜¯æ‰§è¡Œæ‰€æœ‰BeanFactory åç½®å¢å¼ºå™¨\"></a>refresh() ä¸­çš„ invokeBeanFactoryPostProcessors æ–¹æ³•å°±æ˜¯æ‰§è¡Œæ‰€æœ‰BeanFactory åç½®å¢å¼ºå™¨</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n   <span class=\"token class-name\">PostProcessorRegistrationDelegate</span><span class=\"token punctuation\">.</span><span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> <span class=\"token function\">getBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime</span>\n   <span class=\"token comment\">// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)</span>\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">NativeDetector</span><span class=\"token punctuation\">.</span><span class=\"token function\">inNativeImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getTempClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">containsBean</span><span class=\"token punctuation\">(</span><span class=\"token constant\">LOAD_TIME_WEAVER_BEAN_NAME</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">addBeanPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LoadTimeWeaverAwareProcessor</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">setTempClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ContextTypeMatchClassLoader</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"BeanFactoryPostProcessoræ‰§è¡Œ\"><a href=\"#BeanFactoryPostProcessoræ‰§è¡Œ\" class=\"headerlink\" title=\"BeanFactoryPostProcessoræ‰§è¡Œ\"></a>BeanFactoryPostProcessoræ‰§è¡Œ</h3><h4 id=\"æ‰§è¡ŒinvokeBeanFactoryPostProcessors-æ ¸å¿ƒé€»è¾‘\"><a href=\"#æ‰§è¡ŒinvokeBeanFactoryPostProcessors-æ ¸å¿ƒé€»è¾‘\" class=\"headerlink\" title=\"æ‰§è¡ŒinvokeBeanFactoryPostProcessors æ ¸å¿ƒé€»è¾‘\"></a>æ‰§è¡ŒinvokeBeanFactoryPostProcessors æ ¸å¿ƒé€»è¾‘</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>\n      <span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">></span></span> beanFactoryPostProcessors<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n   <span class=\"token comment\">// WARNING: Although it may appear that the body of this method can be easily</span>\n   <span class=\"token comment\">// refactored to avoid the use of multiple loops and multiple lists, the use</span>\n   <span class=\"token comment\">// of multiple lists and multiple passes over the names of processors is</span>\n   <span class=\"token comment\">// intentional. We must ensure that we honor the contracts for PriorityOrdered</span>\n   <span class=\"token comment\">// and Ordered processors. Specifically, we must NOT cause processors to be</span>\n   <span class=\"token comment\">// instantiated (via getBean() invocations) or registered in the ApplicationContext</span>\n   <span class=\"token comment\">// in the wrong order.</span>\n   <span class=\"token comment\">//</span>\n   <span class=\"token comment\">// Before submitting a pull request (PR) to change this method, please review the</span>\n   <span class=\"token comment\">// list of all declined PRs involving changes to PostProcessorRegistrationDelegate</span>\n   <span class=\"token comment\">// to ensure that your proposal does not result in a breaking change:</span>\n   <span class=\"token comment\">// https://github.com/spring-projects/spring-framework/issues?q=PostProcessorRegistrationDelegate+is%3Aclosed+label%3A%22status%3A+declined%22</span>\n\n   <span class=\"token comment\">// Invoke BeanDefinitionRegistryPostProcessors first, if any.</span>\n   <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> processedBeans <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">BeanDefinitionRegistry</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">BeanDefinitionRegistry</span> registry <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistry</span><span class=\"token punctuation\">)</span> beanFactory<span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">></span></span> regularPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">></span></span> registryProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanFactoryPostProcessor</span> postProcessor <span class=\"token operator\">:</span> beanFactoryPostProcessors<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>postProcessor <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span> registryProcessor <span class=\"token operator\">=</span>\n                  <span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">)</span> postProcessor<span class=\"token punctuation\">;</span>\n            registryProcessor<span class=\"token punctuation\">.</span><span class=\"token function\">postProcessBeanDefinitionRegistry</span><span class=\"token punctuation\">(</span>registry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            registryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>registryProcessor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n            regularPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>postProcessor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token comment\">// Do not initialize FactoryBeans here: We need to leave all regular beans</span>\n      <span class=\"token comment\">// uninitialized to let the bean factory post-processors apply to them!</span>\n      <span class=\"token comment\">// Separate between BeanDefinitionRegistryPostProcessors that implement</span>\n      <span class=\"token comment\">// PriorityOrdered, Ordered, and the rest.</span>\n      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">></span></span> currentRegistryProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// First, invoke the BeanDefinitionRegistryPostProcessors that implement PriorityOrdered.</span>\n\n      <span class=\"token comment\">//é¦–å…ˆï¼Œè°ƒç”¨å®ç° PriorityOrdered çš„ BeanDefinitionRegistryPostProcessor</span>\n      <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> postProcessorNames <span class=\"token operator\">=</span>\n            beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanNamesForType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> postProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦å®ç°äº†é¡ºåºæ¥å£ï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span>\n         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PriorityOrdered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">// ä»å®¹å™¨ä¸­è·å–è¿™ä¸ªç»„ä»¶ï¼Œå¹¶æ”¾åˆ°è¯¥é›†åˆï¼ŒgetBean æ²¡æœ‰åˆ™ä¼šå»åˆ›å»º</span>\n            currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      registryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// æ‰§è¡Œ å½“å‰æ¥å£çš„postProcessBeanDefinitionRegistry</span>\n      <span class=\"token function\">invokeBeanDefinitionRegistryPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> registry<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getApplicationStartup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Next, invoke the BeanDefinitionRegistryPostProcessors that implement Ordered.</span>\n      postProcessorNames <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanNamesForType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> postProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Ordered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      registryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">invokeBeanDefinitionRegistryPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> registry<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getApplicationStartup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Finally, invoke all other BeanDefinitionRegistryPostProcessors until no further ones appear.</span>\n      <span class=\"token keyword\">boolean</span> reiterate <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>reiterate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         reiterate <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n         postProcessorNames <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanNamesForType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> postProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n               currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanDefinitionRegistryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n               processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n               reiterate <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         registryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token function\">invokeBeanDefinitionRegistryPostProcessors</span><span class=\"token punctuation\">(</span>currentRegistryProcessors<span class=\"token punctuation\">,</span> registry<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getApplicationStartup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         currentRegistryProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token comment\">// Now, invoke the postProcessBeanFactory callback of all processors handled so far.</span>\n      <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>registryProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>regularPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n\n   <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token comment\">// Invoke factory processors registered with the context instance.</span>\n      <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>beanFactoryPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n\n   <span class=\"token comment\">// Do not initialize FactoryBeans here: We need to leave all regular beans</span>\n   <span class=\"token comment\">// uninitialized to let the bean factory post-processors apply to them!</span>\n   <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> postProcessorNames <span class=\"token operator\">=</span>\n         beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanNamesForType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Separate between BeanFactoryPostProcessors that implement PriorityOrdered,</span>\n   <span class=\"token comment\">// Ordered, and the rest.</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">></span></span> priorityOrderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> orderedPostProcessorNames <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> nonOrderedPostProcessorNames <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> postProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>processedBeans<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token comment\">// skip - already processed in first phase above</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PriorityOrdered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         priorityOrderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Ordered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         orderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n         nonOrderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n\n   <span class=\"token comment\">// First, invoke the BeanFactoryPostProcessors that implement PriorityOrdered.</span>\n   <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>priorityOrderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>priorityOrderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Next, invoke the BeanFactoryPostProcessors that implement Ordered.</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">></span></span> orderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>orderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> postProcessorName <span class=\"token operator\">:</span> orderedPostProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      orderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>postProcessorName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>orderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>orderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Finally, invoke all other BeanFactoryPostProcessors.</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">></span></span> nonOrderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>nonOrderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> postProcessorName <span class=\"token operator\">:</span> nonOrderedPostProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      nonOrderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>postProcessorName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanFactoryPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token function\">invokeBeanFactoryPostProcessors</span><span class=\"token punctuation\">(</span>nonOrderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Clear cached merged bean definitions since the post-processors might have</span>\n   <span class=\"token comment\">// modified the original metadata, e.g. replacing placeholders in values...</span>\n   beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">clearMetadataCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>è¿™é‡Œé¦–å…ˆä¼šåˆ¤æ–­ æ˜¯å¦å®ç°BeanDefinitionRegistry æ¥å£ã€‚</p>\n<p>é‡Œé¢åˆ†ä¸‰ç§ </p>\n<p>1ã€å®ç° PriorityOrdered é¡ºåºä¼˜å…ˆçº§æœ€é«˜</p>\n<p>2ã€Orderedé¡ºåºï¼Œä½äºPriorityOrdered </p>\n<p>3ã€æ™®é€šæœªå®ç°é¡ºåºæ¥å£</p>\n<p>æŒ‰ç…§è¿™æ ·çš„é¡ºåºå»è°ƒç”¨ invokeBeanFactoryPostProcessors ï¼Œå°±æ˜¯æ¥å£çš„æ ¹æ–¹æ³•</p>\n<p>é¡ºåºéƒ½æ˜¯æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</p>\n<p>invokeBeanFactoryPostProcessors ä¸­ä¼šå¾ªç¯è°ƒç”¨ç›¸å…³æ¥å£çš„æ–¹æ³•</p>\n<h3 id=\"å®ä¾‹åˆ†æ\"><a href=\"#å®ä¾‹åˆ†æ\" class=\"headerlink\" title=\"å®ä¾‹åˆ†æ\"></a>å®ä¾‹åˆ†æ</h3><h4 id=\"ConfigurationClassPostProcessor\"><a href=\"#ConfigurationClassPostProcessor\" class=\"headerlink\" title=\"ConfigurationClassPostProcessor\"></a>ConfigurationClassPostProcessor</h4><p>å°±æ˜¯é€šè¿‡å®ç°BeanDefinitionRegistryPostProcessorï¼Œæ‰«æé…ç½®ç±»åŠå…¶ç›¸å…³æ³¨è§£ï¼Œå¦‚@Componment @componmentScan æ¥å°†è¿™äº›ä¿¡æ¯å°è£…ä¸ºBeanDefinitionä»¥ä¾›åç»­åˆ›å»ºbeançš„å®šä¹‰ä¿¡æ¯</p>\n<h2 id=\"ç±»å‹äºŒï¼šBeanPostProcessorç±»å‹ä¸ºBeançš„åç½®å¤„ç†å™¨å¢å¼º\"><a href=\"#ç±»å‹äºŒï¼šBeanPostProcessorç±»å‹ä¸ºBeançš„åç½®å¤„ç†å™¨å¢å¼º\" class=\"headerlink\" title=\"ç±»å‹äºŒï¼šBeanPostProcessorç±»å‹ä¸ºBeançš„åç½®å¤„ç†å™¨å¢å¼º\"></a>ç±»å‹äºŒï¼šBeanPostProcessorç±»å‹ä¸ºBeançš„åç½®å¤„ç†å™¨å¢å¼º</h2><h3 id=\"BeanPostProcessorçš„æ³¨å†Œ\"><a href=\"#BeanPostProcessorçš„æ³¨å†Œ\" class=\"headerlink\" title=\"BeanPostProcessorçš„æ³¨å†Œ\"></a>BeanPostProcessorçš„æ³¨å†Œ</h3><p>refreshï¼ˆï¼‰æ–¹æ³•ä¸­çš„registerBeanPostProcessorsï¼ˆbeanFactoryï¼‰ å…¥å£</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>\n      <span class=\"token class-name\">ConfigurableListableBeanFactory</span> beanFactory<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AbstractApplicationContext</span> applicationContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n   <span class=\"token comment\">// WARNING: Although it may appear that the body of this method can be easily</span>\n   <span class=\"token comment\">// refactored to avoid the use of multiple loops and multiple lists, the use</span>\n   <span class=\"token comment\">// of multiple lists and multiple passes over the names of processors is</span>\n   <span class=\"token comment\">// intentional. We must ensure that we honor the contracts for PriorityOrdered</span>\n   <span class=\"token comment\">// and Ordered processors. Specifically, we must NOT cause processors to be</span>\n   <span class=\"token comment\">// instantiated (via getBean() invocations) or registered in the ApplicationContext</span>\n   <span class=\"token comment\">// in the wrong order.</span>\n   <span class=\"token comment\">//</span>\n   <span class=\"token comment\">// Before submitting a pull request (PR) to change this method, please review the</span>\n   <span class=\"token comment\">// list of all declined PRs involving changes to PostProcessorRegistrationDelegate</span>\n   <span class=\"token comment\">// to ensure that your proposal does not result in a breaking change:</span>\n   <span class=\"token comment\">// https://github.com/spring-projects/spring-framework/issues?q=PostProcessorRegistrationDelegate+is%3Aclosed+label%3A%22status%3A+declined%22</span>\n\n   <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> postProcessorNames <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanNamesForType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Register BeanPostProcessorChecker that logs an info message when</span>\n   <span class=\"token comment\">// a bean is created during BeanPostProcessor instantiation, i.e. when</span>\n   <span class=\"token comment\">// a bean is not eligible for getting processed by all BeanPostProcessors.</span>\n   <span class=\"token keyword\">int</span> beanProcessorTargetCount <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanPostProcessorCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> postProcessorNames<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n   beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">addBeanPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanPostProcessorChecker</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> beanProcessorTargetCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Separate between BeanPostProcessors that implement PriorityOrdered,</span>\n   <span class=\"token comment\">// Ordered, and the rest.</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">></span></span> priorityOrderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">></span></span> internalPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> orderedPostProcessorNames <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> nonOrderedPostProcessorNames <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> postProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token comment\">// è·å–æ‰€æœ‰å®ç° PriorityOrdered</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PriorityOrdered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token class-name\">BeanPostProcessor</span> pp <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         priorityOrderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token comment\">//  å†…éƒ¨çš„</span>\n         <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pp <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">MergedBeanDefinitionPostProcessor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            internalPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeMatch</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Ordered</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         orderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n         nonOrderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n\n   <span class=\"token comment\">// First, register the BeanPostProcessors that implement PriorityOrdered.</span>\n\n   <span class=\"token comment\">//é¦–å…ˆï¼Œæ³¨å†Œå®ç° PriorityOrdered çš„ BeanPostProcessorã€‚</span>\n   <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>priorityOrderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> priorityOrderedPostProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Next, register the BeanPostProcessors that implement Ordered.</span>\n   <span class=\"token comment\">// æ¥ä¸‹æ¥ï¼Œæ³¨å†Œå®ç° Ordered çš„ BeanPostProcessorã€‚</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">></span></span> orderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>orderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> orderedPostProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">BeanPostProcessor</span> pp <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      orderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pp <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">MergedBeanDefinitionPostProcessor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         internalPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>orderedPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> orderedPostProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Now, register all regular BeanPostProcessors.</span>\n   <span class=\"token comment\">// ç°åœ¨ï¼Œæ³¨å†Œæ‰€æœ‰å¸¸è§„çš„ BeanPostProcessorã€‚ getBean</span>\n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">></span></span> nonOrderedPostProcessors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>nonOrderedPostProcessorNames<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> ppName <span class=\"token operator\">:</span> nonOrderedPostProcessorNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">BeanPostProcessor</span> pp <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>ppName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanPostProcessor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      nonOrderedPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pp <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">MergedBeanDefinitionPostProcessor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         internalPostProcessors<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>pp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> nonOrderedPostProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Finally, re-register all internal BeanPostProcessors.</span>\n   <span class=\"token function\">sortPostProcessors</span><span class=\"token punctuation\">(</span>internalPostProcessors<span class=\"token punctuation\">,</span> beanFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">registerBeanPostProcessors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> internalPostProcessors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token comment\">// Re-register post-processor for detecting inner beans as ApplicationListeners,</span>\n   <span class=\"token comment\">// moving it to the end of the processor chain (for picking up proxies etc).</span>\n   beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">addBeanPostProcessor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ApplicationListenerDetector</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>æµç¨‹å¦‚ä¸Šï¼Œå’ŒBeanFactoryPostProcessor å¤§è‡´é€»è¾‘ç±»ä¼¼æ•´ä¸ªæµç¨‹å®Œæˆæ³¨å†Œ</p>\n<h3 id=\"BeanPostProcessoræ‰§è¡Œ\"><a href=\"#BeanPostProcessoræ‰§è¡Œ\" class=\"headerlink\" title=\"BeanPostProcessoræ‰§è¡Œ\"></a>BeanPostProcessoræ‰§è¡Œ</h3><blockquote>\n<p>ç”±äºå„ç§ç±»å‹çš„BeanPostProcessoråœ¨Beançš„ç”Ÿå‘½å‘¨æœŸå¹²æ‰°çš„æ—¶æœºä¸åŒï¼Œæ‰€ä»¥æ‰§è¡Œçš„æ—¶æœºä¹Ÿæ˜¯ä¸åŒçš„ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼šåˆ†åˆ«é’ˆå¯¹å„ä¸ªå­ç±»BeanPostProcessoræ¥å£ä»£ç åˆ†æå¹²æ‰°çš„æ—¶æœº</p>\n</blockquote>\n<h4 id=\"SmartInstantiationAwareBeanPostProcessor\"><a href=\"#SmartInstantiationAwareBeanPostProcessor\" class=\"headerlink\" title=\"SmartInstantiationAwareBeanPostProcessor\"></a>SmartInstantiationAwareBeanPostProcessor</h4><h4 id=\"InstantiationAwareBeanPostProcessor\"><a href=\"#InstantiationAwareBeanPostProcessor\" class=\"headerlink\" title=\"InstantiationAwareBeanPostProcessor\"></a>InstantiationAwareBeanPostProcessor</h4><h4 id=\"MergedBeanDefinitionPostProcessor\"><a href=\"#MergedBeanDefinitionPostProcessor\" class=\"headerlink\" title=\"MergedBeanDefinitionPostProcessor\"></a>MergedBeanDefinitionPostProcessor</h4><h2 id=\"ç±»å‹ä¸‰ï¼šInitializingBean-å®Œæˆbean-åˆå§‹åŒ–åçš„æ“ä½œ\"><a href=\"#ç±»å‹ä¸‰ï¼šInitializingBean-å®Œæˆbean-åˆå§‹åŒ–åçš„æ“ä½œ\" class=\"headerlink\" title=\"ç±»å‹ä¸‰ï¼šInitializingBean å®Œæˆbean åˆå§‹åŒ–åçš„æ“ä½œ\"></a>ç±»å‹ä¸‰ï¼šInitializingBean å®Œæˆbean åˆå§‹åŒ–åçš„æ“ä½œ</h2><p>å †æ ˆæ–¹æ³•è¿½è¸ªï¼šgetBean-&gt;doGetBean-&gt;getSingleton-&gt;createBean-&gt;doCreateBean-&gt;initializeBean-&gt;invokeInitMethods  </p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">invokeInitMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Nullable</span> <span class=\"token class-name\">RootBeanDefinition</span> mbd<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span> <span class=\"token punctuation\">&#123;</span>\n\n   <span class=\"token keyword\">boolean</span> isInitializingBean <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>bean <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">InitializingBean</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isInitializingBean <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>mbd <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>mbd<span class=\"token punctuation\">.</span><span class=\"token function\">isExternallyManagedInitMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"afterPropertiesSet\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">isTraceEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         logger<span class=\"token punctuation\">.</span><span class=\"token function\">trace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invoking afterPropertiesSet() on bean with name '\"</span> <span class=\"token operator\">+</span> beanName <span class=\"token operator\">+</span> <span class=\"token string\">\"'\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSecurityManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token class-name\">AccessController</span><span class=\"token punctuation\">.</span><span class=\"token function\">doPrivileged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PrivilegedExceptionAction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span>\n               <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InitializingBean</span><span class=\"token punctuation\">)</span> bean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n               <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getAccessControlContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">PrivilegedActionException</span> pae<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token keyword\">throw</span> pae<span class=\"token punctuation\">.</span><span class=\"token function\">getException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InitializingBean</span><span class=\"token punctuation\">)</span> bean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mbd <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> bean<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token class-name\">NullBean</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token class-name\">String</span> initMethodName <span class=\"token operator\">=</span> mbd<span class=\"token punctuation\">.</span><span class=\"token function\">getInitMethodName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasLength</span><span class=\"token punctuation\">(</span>initMethodName<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n            <span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>isInitializingBean <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">\"afterPropertiesSet\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>initMethodName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n            <span class=\"token operator\">!</span>mbd<span class=\"token punctuation\">.</span><span class=\"token function\">isExternallyManagedInitMethod</span><span class=\"token punctuation\">(</span>initMethodName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         <span class=\"token function\">invokeCustomInitMethod</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> bean<span class=\"token punctuation\">,</span> mbd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>bean å®Œæˆä¹‹åä¼šæ‰§è¡ŒInitializingBean.afterPropertiesSet</p>\n<h2 id=\"æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæµç¨‹åç½®å¤„ç†å™¨å¹²æ‰°å›¾\"><a href=\"#æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæµç¨‹åç½®å¤„ç†å™¨å¹²æ‰°å›¾\" class=\"headerlink\" title=\"æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæµç¨‹åç½®å¤„ç†å™¨å¹²æ‰°å›¾\"></a>æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæµç¨‹åç½®å¤„ç†å™¨å¹²æ‰°å›¾</h2><p><img src=\"http://hyqup-blog-upyun.test.upcdn.net/img/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%A2%9E%E5%BC%BA%E5%99%A8.drawio.png\"></p>","categories":[{"name":"Java","path":"api/categories/Java.json"},{"name":"Springæºç ","path":"api/categories/Springæºç .json"}],"tags":[{"name":"BeanPostProcessor","path":"api/tags/BeanPostProcessor.json"},{"name":"BeanFactoryPostProcessor","path":"api/tags/BeanFactoryPostProcessor.json"}]}